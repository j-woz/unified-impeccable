= unified-impeccable

== Steps

Step 1 "HTP Docking"::
code is /htp_docking
+
`sub_p1_s1`: WALLTIME=20m - success in <22 minutes

. Step 2: "Surrogate Training": code is /surrogate_training
sub_p1_s2 - WALLTIME=1h - success in <10 minutes

. Step 3: "Surrogate Inference":  code is /surrogate_inference
sub_p1_s3 - WALLTIME=1h - success in <5 minutes


== Script architecture

=== Install time

* install-conda-pkgs.sh

=== Workflow-level

* setup-SITE.sh
** General Software
*** Sets up non-Python software (licenses, schedulers)
** python-SITE.sh
*** Loads Anaconda, etc.
** User Settings
** Specific to the user that cloned the workflow.  User must specify the location of the IMPECCABLE clone and a desired output directory.
* settings.sh
** Application-level settings for a specific science run.
** User may edit this to set SMILES_INPUT, RECEP_FILE, INFERENCE_DATA location

=== Step-level

* submit-SITE.sh
* STEP-SITE.sh (e.g., sub_p1_s1-aurora.sh)
** sources workflow-level settings
* STEP-setup.sh
** Copies software to WORK_DIR
** Sets up MEM_DIR
** Filters input files

== Typical user scenario

. Clone IMPECCABLE
. Clone this workflow repo
. Set up Python and run install-conda-pkgs.sh
.. Specify python configuration in python-SITE.sh
. Edit setup-SITE.sh for license and any other software
. Obtain inference data
. Edit settings.sh to set up INFERENCE_DATA location, etc.
. Start step with stepN/submit-SITE.sh +

== Step progress

. User invokes `stepN/submit-SITE.sh` .  This submits the job to the scheduler.
. This runs `stepN/sub_pP_sN-SITE.sh` ,
.. which refers to `../setup-SITE.sh` for settings and
.. loads application settings from `../settings.sh`
. `sub_pP_sN-SITE.sh`:
.. contains the SITE-specific scheduler settings and
.. invokes the science codes via `mpiexec`, `srun`, etc.

== TODO

=== Justin

Insert DB commands

Create settings file with:
  PROJECT/ACCOUNT
  IMPECCABLE location

Per-campaign job directory
  EXP001, EXP002, ...

Output stream from job should go into job output directory

PSI/J

=== Ketan

Try step4
