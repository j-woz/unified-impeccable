= unified-impeccable

== Steps

Step 1 "HTP Docking"::
Code is `/htp_docking`
+
`sub_p1_s1`: WALLTIME=20m
+
* Frontier: success in <22 minutes
* Aurora:   success in <?? minutes

Step 2: "Surrogate Training"::
Code is `/surrogate_training`
+
`sub_p1_s2`: - WALLTIME=1h
+
* Frontier: success in <10 minutes
* Aurora:   success in <2 minutes

Step 3: "Surrogate Inference"::
Code is `/surrogate_inference`
+
`sub_p1_s3` - WALLTIME=1h - success in <5 minutes

== Script architecture

=== Install time

* `install-py-pkgs.sh`

=== Workflow-level

* setup-SITE.sh
** General Software
*** Sets up non-Python software (licenses, schedulers)
** Python Settings
*** Loads Anaconda, etc.
** User Settings
*** Specific to the user that cloned the workflow.  User must specify the location of the IMPECCABLE clone and a desired output directory.
* settings.sh
** Application-level settings for a specific science run.
** User may edit this to set SMILES_INPUT, RECEP_FILE, INFERENCE_DATA location

== Typical user scenario

. Clone IMPECCABLE
. Clone this workflow repo
. Set up Python and run `install-py-pkgs.sh`
. Edit `setup-SITE.sh` for license and any other software, including Python
. Obtain inference data
.. On Frontier, at: +
`/lustre/orion/chm155/proj-shared/apbhati/InferenceData` +
You can point to this or make a copy.
. Edit `settings.sh` to set up the `INFERENCE_DATA` location, etc.
. Start step with `stepN/submit-SITE.sh`

== Step progress model

. User invokes `stepN/submit-SITE.sh` .  This submits the job to the scheduler.
. This runs `stepN/sub_pP_sN-SITE.sh` ,
.. which refers to `../setup-SITE.sh` for site settings and
.. loads application settings from `../settings.sh`
. `sub_pP_sN-SITE.sh`:
.. sources `sub_pP_sN-setup.sh`, whicih:
... Sets up `CODE_DIR`, `WORK_DIR`, `MEM_DIR`
... Copies software to `WORK_DIR`
... Filters input files via m4 (e.g., JSON)
.. contains the SITE-specific scheduler settings and
.. invokes the science codes via `mpiexec`, `srun`, etc.

== TODO

=== Justin

Insert DB commands

Create settings file with:
  PROJECT/ACCOUNT
  IMPECCABLE location - DONE

Per-campaign job directory
  EXP001, EXP002, ...

Output stream from job should go into job output directory

PSI/J

=== Ketan

Try step4
